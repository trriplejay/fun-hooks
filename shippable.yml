resources:

############################################
# The basics. used in all jobs.
############################################
  - name: hook-repo
    type: gitRepo
    integration: github
    versionTemplate:
      sourceName: trriplejay/fun-hooks
      branch: master

##############################################
# The hooks. one per job.
##############################################
  - name: translate
    type: webhook
    versionTemplate:
      webhookKey: tCv4fhCogSqmyjmRgvuR

  - name: warmup
    type: webhook
    versionTemplate:
      webhookKey: hAlQjJboj5ZALQENheQN


jobs:
  - name: execute-warmup
    type: runSh
    steps:
      - IN: warmup
      - IN: hook-repo
        switch: off
      - TASK:
          script:
            - sudo apt-get install libssl-dev
            - pushd $(shipctl get_resource_state hook-repo)
            - HOOK_META=$(shipctl get_resource_meta warmup)
            - export response_url=$(shipctl get_json_value "$HOOK_META/version.json" "version.propertyBag.payload.response_url")
            - sh respond.sh "engines online..."
    on_success:
      script:
        - echo "machine is warm"
    on_failure:
      script:
        - echo "something went wrong!"


  - name: execute-translate
    type: runSh
    steps:
      - IN: hook-repo
        switch: off
      - IN: translate
      - TASK:
          script:
            - echo "translating..."
            - pushd $(shipctl get_resource_state hook-repo)
            - HOOK_META=$(shipctl get_resource_meta warmup)
            - export response_url=$(shipctl get_json_value "$HOOK_META/version.json" "version.propertyBag.payload.response_url")
            - export message=$(shipctl get_json_value "$HOOK_META/version.json" "version.propertyBag.payload.text")
            - export user=$(shipctl get_json_value "$HOOK_META/version.json" "version.propertyBag.payload.user_name")
            - result=$(sh translate.sh)
            - sh respond.sh "$user says $result"
